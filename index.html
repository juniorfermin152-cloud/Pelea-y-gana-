<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Juego de Pelea 2D Web</title>
<style>
body { margin:0; overflow:hidden; font-family:Arial; background:#111; color:white; text-align:center; }
canvas { background:#222; border:2px solid white; display:block; margin:auto; }
#startScreen, #gameOverScreen { position:absolute; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); display:flex; flex-direction:column; justify-content:center; align-items:center; }
button { padding:15px 30px; font-size:20px; cursor:pointer; margin-top:20px; }
</style>
</head>
<body>

<div id="startScreen">
  <h1>Juego de Pelea 2D Web</h1>
  <button id="startBtn">Jugar</button>
</div>

<div id="gameOverScreen" style="display:none;">
  <h1>¡Juego Terminado!</h1>
  <p id="finalScore"></p>
  <button id="restartBtn">Reiniciar</button>
</div>

<canvas id="gameCanvas" width="800" height="500"></canvas>

<script>
// Canvas
var canvas = document.getElementById("gameCanvas");
var ctx = canvas.getContext("2d");

// Jugador
var player = { x:100, y:250, w:40, h:40, color:"blue", speed:5, isAttacking:false, attackTimer:0 };

// Enemigos
var enemies = [];
var enemySpeed = 2;
var spawnInterval = 2000;

// Partículas
var particles = [];

// Puntos y niveles
var score = 0;
var level = 1;
var nextLevelScore = 100;

// Estados
var gameRunning = false;

// Sonidos
var attackSound = new Audio("https://www.soundjay.com/button/sounds/button-16.mp3");
var hitSound = new Audio("https://www.soundjay.com/button/sounds/button-10.mp3");
var bgMusic = new Audio("https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3");
bgMusic.loop = true; bgMusic.volume = 0.3;

// Teclado
var keys = {};
window.addEventListener("keydown", function(e){
    keys[e.key.toLowerCase()] = true;
    if(gameRunning && e.code=="Space" && !player.isAttacking){
        player.isAttacking=true;
        player.attackTimer=10;
        attackSound.play();
    }
});
window.addEventListener("keyup", function(e){
    keys[e.key.toLowerCase()]=false;
    if(e.code=="Space") player.isAttacking=false;
});

// Funciones
function spawnEnemy(){
    if(!gameRunning) return;
    var enemy = { x:canvas.width-50, y:Math.random()*(canvas.height-40), w:40, h:40, color:"red", speed:enemySpeed };
    enemies.push(enemy);
}

function isColliding(a,b){
    return a.x < b.x+b.w && a.x+a.w>b.x && a.y<b.y+b.h && a.y+a.h>b.y;
}

// Partículas
function createParticles(x,y,color,count){
    for(var i=0;i<count;i++){
        particles.push({ x:x, y:y, vx:(Math.random()-0.5)*4, vy:(Math.random()-0.5)*4, alpha:1, color:color, size:Math.random()*4+2 });
    }
}
function updateParticles(){
    for(var i=particles.length-1;i>=0;i--){
        var p=particles[i];
        p.x+=p.vx; p.y+=p.vy; p.alpha-=0.03;
        if(p.alpha<=0) particles.splice(i,1);
    }
}
function drawParticles(){
    for(var i=0;i<particles.length;i++){
        var p=particles[i];
        ctx.globalAlpha=p.alpha;
        ctx.fillStyle=p.color;
        ctx.fillRect(p.x,p.y,p.size,p.size);
    }
    ctx.globalAlpha=1;
}

// Niveles
function updateLevel(){
    if(score>=nextLevelScore){
        level++;
        enemySpeed += 0.5;
        spawnInterval -= 150;
        if(spawnInterval<500) spawnInterval=500;
        nextLevelScore += 50;
        createParticles(canvas.width/2, canvas.height/2, "yellow", 50);
    }
}

// Flash pantalla
var flashAlpha=0;
var flashColor="white";
function flashScreen(color,duration){ flashColor=color; flashAlpha=0.6; setTimeout(function(){ flashAlpha=0; },duration); }

// Update
function update(){
    if(!gameRunning) return;

    if(keys["w"] && player.y>0) player.y-=player.speed;
    if(keys["s"] && player.y+player.h<canvas.height) player.y+=player.speed;
    if(keys["a"] && player.x>0) player.x-=player.speed;
    if(keys["d"] && player.x+player.w<canvas.width) player.x+=player.speed;

    for(var i=enemies.length-1;i>=0;i--){
        var enemy = enemies[i];
        enemy.x -= enemy.speed;

        if(player.isAttacking && isColliding(player,enemy)){
            createParticles(enemy.x+enemy.w/2,enemy.y+enemy.h/2,"red",20);
            enemies.splice(i,1);
            score+=10;
            hitSound.play();
            updateLevel();
            continue;
        }

        if(isColliding(player,enemy)){
            endGame();
        }

        if(enemy.x+enemy.w<0) enemies.splice(i,1);
    }

    if(player.attackTimer>0){ 
        player.attackTimer--; 
        createParticles(player.x+player.w+10, player.y+20,"cyan",2);
    }

    updateParticles();
}

// Draw
function draw(){
    ctx.clearRect(0,0,canvas.width,canvas.height);

    ctx.fillStyle=player.color;
    ctx.fillRect(player.x,player.y,player.w,player.h);

    for(var i=0;i<enemies.length;i++){
        ctx.fillStyle=enemies[i].color;
        ctx.fillRect(enemies[i].x,enemies[i].y,enemies[i].w,enemies[i].h);
    }

    if(player.isAttacking){
        ctx.fillStyle="cyan";
        ctx.fillRect(player.x+player.w,player.y+10,20,20);
    }

    drawParticles();

    ctx.fillStyle="white";
    ctx.font="20px Arial";
    ctx.fillText("Puntos: "+score,650,30);
    ctx.fillText("Nivel: "+level,650,60);
    ctx.fillText("Siguiente nivel: "+nextLevelScore+" pts",650,90);

    if(flashAlpha>0){
        ctx.fillStyle=flashColor;
        ctx.globalAlpha=flashAlpha;
        ctx.fillRect(0,0,canvas.width,canvas.height);
        ctx.globalAlpha=1;
    }
}

// Loop principal
function gameLoop(){ update(); draw(); if(gameRunning) requestAnimationFrame(gameLoop); }
gameLoop();

// Spawn dinámico
function spawnLoop(){ 
    if(gameRunning){ spawnEnemy(); setTimeout(spawnLoop,spawnInterval); }
}

// Iniciar juego
document.getElementById("startBtn").onclick=function(){
    document.getElementById("startScreen").style.display="none";
    startGame();
};

// Reiniciar juego
document.getElementById("restartBtn").onclick=function(){
    document.getElementById("gameOverScreen").style.display="none";
    startGame();
};

function startGame(){
    player.x=100; player.y=250; player.isAttacking=false; player.attackTimer=0;
    enemies=[]; particles=[];
    score=0; level=1; nextLevelScore=100;
    enemySpeed=2; spawnInterval=2000;
    gameRunning=true;
    bgMusic.currentTime=0; bgMusic.play();
    spawnLoop();
    gameLoop();
}

// Fin de juego
function endGame(){
    gameRunning=false;
    bgMusic.pause();
    flashScreen("red",300);
    setTimeout(function(){
        document.getElementById("finalScore").innerHTML="Puntos: "+score+" | Nivel: "+level;
        document.getElementById("gameOverScreen").style.display="flex";
    },300);
}
</script>